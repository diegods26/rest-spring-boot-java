<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/rest-spring-boot-java/src/main/java/br/com/diegopimenta/services/UserService.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/rest-spring-boot-java/src/main/java/br/com/diegopimenta/services/UserService.java" />
              <option name="originalContent" value="package br.com.diegopimenta.services;&#10;&#10;import br.com.diegopimenta.controllers.UserController;&#10;import br.com.diegopimenta.dto.UserDTO;&#10;import static br.com.diegopimenta.mapper.ObjectMapper.parseObject;&#10;import static br.com.diegopimenta.mapper.ObjectMapper.parseListObjects;&#10;import static org.springframework.hateoas.server.mvc.WebMvcLinkBuilder.linkTo;&#10;import static org.springframework.hateoas.server.mvc.WebMvcLinkBuilder.methodOn;&#10;&#10;import br.com.diegopimenta.dto.UserDtoV2;&#10;import br.com.diegopimenta.mapper.CustomMapper;&#10;import br.com.diegopimenta.model.User;&#10;import br.com.diegopimenta.repositories.UserRepository;&#10;import lombok.RequiredArgsConstructor;&#10;import org.springframework.stereotype.Service;&#10;&#10;import java.util.List;&#10;import java.util.logging.Logger;&#10;&#10;@Service&#10;@RequiredArgsConstructor&#10;public class UserService {&#10;&#10;    private final UserRepository userRepository;&#10;    private final CustomMapper customMapper;&#10;    private Logger logger = Logger.getLogger(UserService.class.getName());&#10;&#10;    public UserDTO getUserById(Long id) {&#10;        logger.info(&quot;Fetching user with id: &quot; + id);&#10;        User entity = userRepository.findById(id).orElse(null);&#10;        var dto = parseObject(entity, UserDTO.class);&#10;&#10;        if (dto != null)&#10;            addHateoasLinks(dto);&#10;&#10;        return dto;&#10;    }&#10;&#10;    public List&lt;UserDTO&gt; getUsers() {&#10;        logger.info(&quot;User list requested&quot;);&#10;&#10;        return parseListObjects(userRepository.findAll(), UserDTO.class);&#10;    }&#10;&#10;    public void createUser(UserDTO user) {&#10;        logger.info(&quot;Creating user: &quot; + user.getName());&#10;&#10;        var entity = parseObject(user, User.class);&#10;        userRepository.save(entity);&#10;    }&#10;&#10;    public void createUserV2(UserDtoV2 user) {&#10;        logger.info(&quot;Creating user V2: &quot; + user.getName());&#10;&#10;        var entity = customMapper.dtoToEntity(user);&#10;        userRepository.save(entity);&#10;    }&#10;&#10;    public List&lt;UserDtoV2&gt; getUsersV2() {&#10;        logger.info(&quot;User list requested&quot;);&#10;&#10;        var users = userRepository.findAll();&#10;        return users.stream()&#10;                .map(customMapper::entityToDTO)&#10;                .toList();&#10;    }&#10;&#10;    private static void addHateoasLinks(UserDTO dto) {&#10;        dto.add(linkTo(methodOn(UserController.class).getUserById(dto.getId())).withSelfRel().withType(&quot;GET&quot;));&#10;        dto.add(linkTo(methodOn(UserController.class).getUsers()).withSelfRel().withType(&quot;GET&quot;));&#10;        dto.add(linkTo(methodOn(UserController.class).createUser(dto)).withSelfRel().withType(&quot;POST&quot;));&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package br.com.diegopimenta.services;&#10;&#10;import br.com.diegopimenta.controllers.UserController;&#10;import br.com.diegopimenta.dto.UserDTO;&#10;import br.com.diegopimenta.dto.UserDtoV2;&#10;import br.com.diegopimenta.mapper.CustomMapper;&#10;import br.com.diegopimenta.model.User;&#10;import br.com.diegopimenta.repositories.UserRepository;&#10;import lombok.RequiredArgsConstructor;&#10;import org.springframework.stereotype.Service;&#10;&#10;import java.util.List;&#10;import java.util.logging.Logger;&#10;&#10;import static org.springframework.hateoas.server.mvc.WebMvcLinkBuilder.linkTo;&#10;import static org.springframework.hateoas.server.mvc.WebMvcLinkBuilder.methodOn;&#10;&#10;@Service&#10;@RequiredArgsConstructor&#10;public class UserService {&#10;&#10;    private final UserRepository userRepository;&#10;    private final CustomMapper customMapper;&#10;    private Logger logger = Logger.getLogger(UserService.class.getName());&#10;&#10;    public UserDTO getUserById(Long id) {&#10;        logger.info(&quot;Fetching user with id: &quot; + id);&#10;        User entity = userRepository.findById(id).orElse(null);&#10;        if (entity == null) return null;&#10;&#10;        var dto = customMapper.entityToDTO(entity);&#10;        addHateoasLinks(dto);&#10;        return dto;&#10;    }&#10;&#10;    private void addHateoasLinks(UserDTO dto) {&#10;        dto.add(linkTo(methodOn(UserController.class).getUserById(dto.getId()))&#10;                .withSelfRel()&#10;                .withType(&quot;GET&quot;));&#10;    }&#10;&#10;    public List&lt;UserDTO&gt; getUsers() {&#10;        logger.info(&quot;User list requested&quot;);&#10;        List&lt;User&gt; entities = userRepository.findAll();&#10;        return entities.stream()&#10;                .map(entity -&gt; {&#10;                    var dto = customMapper.entityToDTO(entity);&#10;                    addHateoasLinks(dto);&#10;                    return dto;&#10;                })&#10;                .toList();&#10;    }&#10;&#10;    public void createUser(UserDTO userDto) {&#10;        logger.info(&quot;Creating user: &quot; + userDto.getName());&#10;        var entity = customMapper.dtoToEntity(userDto);&#10;        userRepository.save(entity);&#10;    }&#10;&#10;    public void createUserV2(UserDtoV2 userDto) {&#10;        logger.info(&quot;Creating user V2: &quot; + userDto.getName());&#10;        var entity = customMapper.dtoToEntity(userDto);&#10;        userRepository.save(entity);&#10;    }&#10;&#10;    public List&lt;UserDtoV2&gt; getUsersV2() {&#10;        logger.info(&quot;User list requested V2&quot;);&#10;        var users = userRepository.findAll();&#10;        return users.stream()&#10;                .map(customMapper::entityToDTOV2)&#10;                .toList();&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/rest-spring-boot-java/src/main/resources/application.yaml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/rest-spring-boot-java/src/main/resources/application.yaml" />
              <option name="originalContent" value="spring:&#10;  application:&#10;    name: rest-spring-boot-java&#10;  profiles:&#10;    active: dev&#10;  datasource:&#10;    driver-class-name: com.mysql.cj.jdbc.Driver&#10;    url: jdbc:mysql://localhost:3306/user_rest_api?useTimezone=true&amp;serverTimezone=UTC&#10;    username: ${USER_DB}&#10;    password: ${PASSWORD_DB}&#10;  jpa:&#10;    hibernate:&#10;      ddl-auto: update&#10;    properties:&#10;      hibernate:&#10;        dialect: org.hibernate.dialect.MySQLDialect&#10;  logging:&#10;    level:&#10;      org:&#10;        springframework:&#10;          web: WARN&#10;" />
              <option name="updatedContent" value="spring:&#10;  application:&#10;    name: rest-spring-boot-java&#10;  profiles:&#10;    active: dev&#10;  datasource:&#10;    driver-class-name: com.mysql.cj.jdbc.Driver&#10;    url: jdbc:mysql://localhost:3306/user_rest_api?useTimezone=true&amp;serverTimezone=UTC&#10;    username: ${USER_DB}&#10;    password: ${PASSWORD_DB}&#10;  jpa:&#10;    hibernate:&#10;      ddl-auto: update&#10;    properties:&#10;      hibernate:&#10;        dialect: org.hibernate.dialect.MySQLDialect&#10;  logging:&#10;    level:&#10;      org:&#10;        springframework:&#10;          web: WARN&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/rest-spring-boot-java/src/test/java/br/com/diegopimenta/mock/MockUser.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/rest-spring-boot-java/src/test/java/br/com/diegopimenta/mock/MockUser.java" />
              <option name="originalContent" value="package br.com.diegopimenta.mock;&#10;&#10;import java.util.ArrayList;&#10;import java.util.List;&#10;&#10;import br.com.diegopimenta.dto.UserDTO;&#10;import br.com.diegopimenta.model.User;&#10;&#10;public class MockUser {&#10;&#10;&#10;    public User mockEntity() {&#10;        return mockEntity(0);&#10;    }&#10;    &#10;    public UserDTO mockDTO() {&#10;        return mockDTO(0);&#10;    }&#10;    &#10;    public List&lt;User&gt; mockEntityList() {&#10;        List&lt;User&gt; persons = new ArrayList&lt;User&gt;();&#10;        for (int i = 0; i &lt; 14; i++) {&#10;            persons.add(mockEntity(i));&#10;        }&#10;        return persons;&#10;    }&#10;&#10;    public List&lt;UserDTO&gt; mockDTOList() {&#10;        List&lt;UserDTO&gt; persons = new ArrayList&lt;&gt;();&#10;        for (int i = 0; i &lt; 14; i++) {&#10;            persons.add(mockDTO(i));&#10;        }&#10;        return persons;&#10;    }&#10;    &#10;    public User mockEntity(Integer number) {&#10;        User user = new User();&#10;        user.setName(&quot;Name Test&quot; + number);&#10;        user.setGender(((number % 2)==0) ? &quot;Male&quot; : &quot;Female&quot;);&#10;        user.setId(number.longValue());&#10;        user.setEmail(&quot;Email Test&quot; + number);&#10;        return user;&#10;    }&#10;&#10;    public UserDTO mockDTO(Integer number) {&#10;        UserDTO user = new UserDTO();&#10;        user.setName(&quot;Name Test&quot; + number);&#10;        user.setGender(((number % 2)==0) ? &quot;Male&quot; : &quot;Female&quot;);&#10;        user.setId(number.longValue());&#10;        user.setEmail(&quot;Email Test&quot; + number);&#10;        return user;&#10;    }&#10;&#10;}" />
              <option name="updatedContent" value="package br.com.diegopimenta.mock;&#10;&#10;import java.util.ArrayList;&#10;import java.util.Date;&#10;import java.util.List;&#10;&#10;import br.com.diegopimenta.dto.UserDTO;&#10;import br.com.diegopimenta.dto.UserDtoV2;&#10;import br.com.diegopimenta.model.User;&#10;&#10;public class MockUser {&#10;&#10;&#10;    public User mockEntity() {&#10;        return mockEntity(0);&#10;    }&#10;    &#10;    public UserDTO mockDTO() {&#10;        return mockDTO(0);&#10;    }&#10;&#10;    public UserDtoV2 mockDTOV2() {&#10;        return mockDTOV2(0);&#10;    }&#10;    &#10;    public List&lt;User&gt; mockEntityList() {&#10;        List&lt;User&gt; persons = new ArrayList&lt;User&gt;();&#10;        for (int i = 0; i &lt; 14; i++) {&#10;            persons.add(mockEntity(i));&#10;        }&#10;        return persons;&#10;    }&#10;&#10;    public List&lt;UserDTO&gt; mockDTOList() {&#10;        List&lt;UserDTO&gt; persons = new ArrayList&lt;&gt;();&#10;        for (int i = 0; i &lt; 14; i++) {&#10;            persons.add(mockDTO(i));&#10;        }&#10;        return persons;&#10;    }&#10;&#10;    public List&lt;UserDtoV2&gt; mockDTOV2List() {&#10;        List&lt;UserDtoV2&gt; persons = new ArrayList&lt;&gt;();&#10;        for (int i = 0; i &lt; 14; i++) {&#10;            persons.add(mockDTOV2(i));&#10;        }&#10;        return persons;&#10;    }&#10;    &#10;    public User mockEntity(Integer number) {&#10;        User user = new User();&#10;        user.setName(&quot;Name Test&quot; + number);&#10;        user.setGender(((number % 2)==0) ? &quot;Male&quot; : &quot;Female&quot;);&#10;        user.setId(number.longValue());&#10;        user.setEmail(&quot;Email Test&quot; + number);&#10;        user.setBirthDate(new Date());&#10;        return user;&#10;    }&#10;&#10;    public UserDTO mockDTO(Integer number) {&#10;        UserDTO user = new UserDTO();&#10;        user.setName(&quot;Name Test&quot; + number);&#10;        user.setGender(((number % 2)==0) ? &quot;Male&quot; : &quot;Female&quot;);&#10;        user.setId(number.longValue());&#10;        user.setEmail(&quot;Email Test&quot; + number);&#10;        return user;&#10;    }&#10;&#10;    public UserDtoV2 mockDTOV2(Integer number) {&#10;        UserDtoV2 user = new UserDtoV2();&#10;        user.setName(&quot;Name Test&quot; + number);&#10;        user.setGender(((number % 2)==0) ? &quot;Male&quot; : &quot;Female&quot;);&#10;        user.setId(number.longValue());&#10;        user.setEmail(&quot;Email Test&quot; + number);&#10;        user.setBirthDate(new Date());&#10;        return user;&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/rest-spring-boot-java/src/test/java/br/com/diegopimenta/services/UserServiceTest.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/rest-spring-boot-java/src/test/java/br/com/diegopimenta/services/UserServiceTest.java" />
              <option name="originalContent" value="package br.com.diegopimenta.services;&#10;&#10;import br.com.diegopimenta.mapper.CustomMapper;&#10;import br.com.diegopimenta.mock.MockUser;&#10;import br.com.diegopimenta.model.User;&#10;import br.com.diegopimenta.repositories.UserRepository;&#10;import org.junit.jupiter.api.BeforeEach;&#10;import org.junit.jupiter.api.Test;&#10;import org.junit.jupiter.api.TestInstance;&#10;import org.junit.jupiter.api.extension.ExtendWith;&#10;import org.mockito.InjectMocks;&#10;import org.mockito.Mock;&#10;import org.mockito.Mockito;&#10;import org.mockito.Spy;&#10;import org.mockito.junit.jupiter.MockitoExtension;&#10;&#10;import java.util.List;&#10;import java.util.Optional;&#10;&#10;import static org.junit.jupiter.api.Assertions.*;&#10;import static org.mockito.ArgumentMatchers.any;&#10;import static org.mockito.Mockito.*;&#10;&#10;@TestInstance(TestInstance.Lifecycle.PER_CLASS)&#10;@ExtendWith(MockitoExtension.class)&#10;class UserServiceTest {&#10;&#10;    MockUser input;&#10;&#10;    @InjectMocks&#10;    private UserService userService;&#10;&#10;    @Mock&#10;    private UserRepository userRepository;&#10;&#10;    @Spy&#10;    private CustomMapper customMapper;&#10;&#10;    @BeforeEach&#10;    void setUp() {&#10;        input = new MockUser();&#10;    }&#10;&#10;    @Test&#10;    void getUserById() {&#10;        User entity = input.mockEntity(1);&#10;        when(userRepository.findById(1L)).thenReturn(Optional.of(entity));&#10;&#10;        var result = userService.getUserById(1L);&#10;        assertNotNull(result);&#10;        assertNotNull(result.getId());&#10;        assertEquals(1L, result.getId());&#10;        assertEquals(&quot;Name Test1&quot;, result.getName());&#10;        assertEquals(&quot;Female&quot;, result.getGender());&#10;        assertEquals(&quot;Email Test1&quot;, result.getEmail());&#10;&#10;//        result.getLinks()&#10;//                .stream()&#10;//                .anyMatch(link -&gt; link.getRel().value().equals(&quot;self&quot;)&#10;//                        &amp;&amp; link.getHref().endsWith(&quot;/api/users/1&quot;)&#10;//                        &amp;&amp; link.getType().equals(&quot;GET&quot;));&#10;    }&#10;&#10;    @Test&#10;    void getUsers() {&#10;        List&lt;User&gt; entities = input.mockEntityList();&#10;        when(userRepository.findAll()).thenReturn(entities);&#10;&#10;        var result = userService.getUsers();&#10;        assertNotNull(result);&#10;        assertEquals(14, result.size());&#10;&#10;        var user = result.get(1);&#10;        assertNotNull(user);&#10;        assertNotNull(user.getId());&#10;        assertEquals(1L, user.getId());&#10;        assertEquals(&quot;Name Test1&quot;, user.getName());&#10;        assertEquals(&quot;Female&quot;, user.getGender());&#10;        assertEquals(&quot;Email Test1&quot;, user.getEmail());&#10;&#10;//        assertTrue(&#10;//                user.getLinks()&#10;//                        .stream()&#10;//                        .anyMatch(link -&gt; link.getRel().value().equals(&quot;self&quot;)&#10;//                                &amp;&amp; link.getHref().endsWith(&quot;/api/users/1&quot;)&#10;//                                &amp;&amp; link.getType().equals(&quot;GET&quot;)));&#10;    }&#10;&#10;    @Test&#10;    void createUser() {&#10;        var dto = input.mockDTO(1);&#10;        var entity = input.mockEntity(1);&#10;        when(userRepository.save(any(User.class))).thenReturn(entity);&#10;&#10;        userService.createUser(dto);&#10;&#10;        verify(userRepository, times(1)).save(any(User.class));&#10;        verify(customMapper, times(1)).dtoToEntity(dto);&#10;    }&#10;&#10;    @Test&#10;    void createUserV2() {&#10;        var dtoV2 = input.mockDTOV2(1);&#10;        var entity = input.mockEntity(1);&#10;        when(userRepository.save(any(User.class))).thenReturn(entity);&#10;&#10;        userService.createUserV2(dtoV2);&#10;&#10;        verify(userRepository, atLeastOnce()).save(any(User.class));&#10;        verify(customMapper, times(1)).dtoToEntity(dtoV2);&#10;    }&#10;&#10;    @Test&#10;    void getUsersV2() {&#10;        List&lt;User&gt; entities = input.mockEntityList();&#10;        when(userRepository.findAll()).thenReturn(entities);&#10;&#10;        var result = userService.getUsersV2();&#10;        assertNotNull(result);&#10;        assertEquals(14, result.size());&#10;&#10;        var user = result.get(1);&#10;        assertNotNull(user);&#10;        assertNotNull(user.getId());&#10;        assertEquals(1L, user.getId());&#10;        assertEquals(&quot;Name Test1&quot;, user.getName());&#10;        assertEquals(&quot;Female&quot;, user.getGender());&#10;        assertEquals(&quot;Email Test1&quot;, user.getEmail());&#10;        assertNotNull(user.getBirthDate());&#10;    }&#10;}" />
              <option name="updatedContent" value="package br.com.diegopimenta.services;&#10;&#10;import br.com.diegopimenta.mapper.CustomMapper;&#10;import br.com.diegopimenta.mock.MockUser;&#10;import br.com.diegopimenta.model.User;&#10;import br.com.diegopimenta.repositories.UserRepository;&#10;import org.junit.jupiter.api.BeforeEach;&#10;import org.junit.jupiter.api.Test;&#10;import org.junit.jupiter.api.extension.ExtendWith;&#10;import org.mockito.InjectMocks;&#10;import org.mockito.Mock;&#10;import org.mockito.Spy;&#10;import org.mockito.junit.jupiter.MockitoExtension;&#10;&#10;import java.util.List;&#10;import java.util.Optional;&#10;&#10;import static org.junit.jupiter.api.Assertions.*;&#10;import static org.mockito.ArgumentMatchers.any;&#10;import static org.mockito.Mockito.*;&#10;&#10;@ExtendWith(MockitoExtension.class)&#10;class UserServiceTest {&#10;&#10;    MockUser input;&#10;&#10;    @InjectMocks&#10;    private UserService userService;&#10;&#10;    @Mock&#10;    private UserRepository userRepository;&#10;&#10;    @Spy&#10;    private CustomMapper customMapper;&#10;&#10;    @BeforeEach&#10;    void setUp() {&#10;        input = new MockUser();&#10;    }&#10;&#10;    @Test&#10;    void getUserById() {&#10;        User entity = input.mockEntity(1);&#10;        when(userRepository.findById(1L)).thenReturn(Optional.of(entity));&#10;&#10;        var result = userService.getUserById(1L);&#10;        assertNotNull(result);&#10;        assertNotNull(result.getId());&#10;        assertEquals(1L, result.getId());&#10;        assertEquals(&quot;Name Test1&quot;, result.getName());&#10;        assertEquals(&quot;Female&quot;, result.getGender());&#10;        assertEquals(&quot;Email Test1&quot;, result.getEmail());&#10;&#10;//        result.getLinks()&#10;//                .stream()&#10;//                .anyMatch(link -&gt; link.getRel().value().equals(&quot;self&quot;)&#10;//                        &amp;&amp; link.getHref().endsWith(&quot;/api/users/1&quot;)&#10;//                        &amp;&amp; link.getType().equals(&quot;GET&quot;));&#10;    }&#10;&#10;    @Test&#10;    void getUsers() {&#10;        List&lt;User&gt; entities = input.mockEntityList();&#10;        when(userRepository.findAll()).thenReturn(entities);&#10;&#10;        var result = userService.getUsers();&#10;        assertNotNull(result);&#10;        assertEquals(14, result.size());&#10;&#10;        var user = result.get(1);&#10;        assertNotNull(user);&#10;        assertNotNull(user.getId());&#10;        assertEquals(1L, user.getId());&#10;        assertEquals(&quot;Name Test1&quot;, user.getName());&#10;        assertEquals(&quot;Female&quot;, user.getGender());&#10;        assertEquals(&quot;Email Test1&quot;, user.getEmail());&#10;&#10;//        assertTrue(&#10;//                user.getLinks()&#10;//                        .stream()&#10;//                        .anyMatch(link -&gt; link.getRel().value().equals(&quot;self&quot;)&#10;//                                &amp;&amp; link.getHref().endsWith(&quot;/api/users/1&quot;)&#10;//                                &amp;&amp; link.getType().equals(&quot;GET&quot;)));&#10;    }&#10;&#10;    @Test&#10;    void createUser() {&#10;        var dto = input.mockDTO(1);&#10;        var entity = input.mockEntity(1);&#10;        when(userRepository.save(any(User.class))).thenReturn(entity);&#10;&#10;        userService.createUser(dto);&#10;&#10;        verify(userRepository, times(1)).save(any(User.class));&#10;        verify(customMapper, times(1)).dtoToEntity(dto);&#10;    }&#10;&#10;    @Test&#10;    void createUserV2() {&#10;        var dtoV2 = input.mockDTOV2(1);&#10;        var entity = input.mockEntity(1);&#10;        when(userRepository.save(any(User.class))).thenReturn(entity);&#10;&#10;        userService.createUserV2(dtoV2);&#10;&#10;        verify(userRepository, atLeastOnce()).save(any(User.class));&#10;        verify(customMapper, times(1)).dtoToEntity(dtoV2);&#10;    }&#10;&#10;    @Test&#10;    void getUsersV2() {&#10;        List&lt;User&gt; entities = input.mockEntityList();&#10;        when(userRepository.findAll()).thenReturn(entities);&#10;&#10;        var result = userService.getUsersV2();&#10;        assertNotNull(result);&#10;        assertEquals(14, result.size());&#10;&#10;        var user = result.get(1);&#10;        assertNotNull(user);&#10;        assertNotNull(user.getId());&#10;        assertEquals(1L, user.getId());&#10;        assertEquals(&quot;Name Test1&quot;, user.getName());&#10;        assertEquals(&quot;Female&quot;, user.getGender());&#10;        assertEquals(&quot;Email Test1&quot;, user.getEmail());&#10;        assertNotNull(user.getBirthDate());&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>